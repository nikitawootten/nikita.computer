<!doctype html><html lang=en dir=ltr class=scroll-smooth data-default-appearance=light data-auto-appearance=true><head><meta charset=utf-8><meta http-equiv=content-language content="en"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=theme-color content="rgb(255,255,255)"><meta http-equiv=x-ua-compatible content="ie=edge"><title>Tips for using Makefiles in your projects &#183; nikita.computer</title><meta name=title content="Tips for using Makefiles in your projects &#183; nikita.computer"><meta name=description content="I have a secret: I adore Makefiles."><link rel=canonical href=https://nikita.computer/posts/makefile-tips/><link type=text/css rel=stylesheet href=/css/main.bundle.min.17fc506b1c26b1bbc9a782ffffc510d9ecbfef39adb801fd6c673c614f713ffe.css integrity="sha256-F/xQaxwmsbvJp4L//8UQ2ey/7zmtuAH9bGc8YU9xP/4="><script type=text/javascript src=/js/appearance.min.022d0ebc3b46a335eb1c7ef79b7f2de143d7cd5156d433638592ef1ce5f8554e.js integrity="sha256-Ai0OvDtGozXrHH73m38t4UPXzVFW1DNjhZLvHOX4VU4="></script>
<script defer type=text/javascript id=script-bundle src=/js/main.bundle.min.75206d23ef83f4908b2bdd2317bf6ddff399e9173a16fff5451c40b8e857cfa8.js integrity="sha256-dSBtI++D9JCLK90jF79t3/OZ6Rc6Fv/1RRxAuOhXz6g=" data-copy=Copy data-copied=Copied></script>
<link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><meta property="og:title" content="Tips for using Makefiles in your projects"><meta property="og:description" content="I have a secret: I adore Makefiles."><meta property="og:type" content="article"><meta property="og:url" content="https://nikita.computer/posts/makefile-tips/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-07-07T21:54:43-04:00"><meta property="article:modified_time" content="2023-07-07T21:54:43-04:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Tips for using Makefiles in your projects"><meta name=twitter:description content="I have a secret: I adore Makefiles."><script type=application/ld+json>[{"@context":"https://schema.org","@type":"Article","articleSection":"Posts","name":"Tips for using Makefiles in your projects","headline":"Tips for using Makefiles in your projects","abstract":"I have a secret: I adore Makefiles.","inLanguage":"en","url":"https:\/\/nikita.computer\/posts\/makefile-tips\/","author":{"@type":"Person","name":"Nikita Wootten"},"copyrightYear":"2023","dateCreated":"2023-07-07T21:54:43-04:00","datePublished":"2023-07-07T21:54:43-04:00","dateModified":"2023-07-07T21:54:43-04:00","keywords":["makefile","nix","tips"],"mainEntityOfPage":"true","wordCount":"1252"}]</script><meta name=author content="Nikita Wootten"><link href=mailto:stdin@nikita.computer rel=me><link href=https://github.com/nikitawootten rel=me><link href=https://www.linkedin.com/in/nikita-wootten/ rel=me><link href=https://mstdn.social/@nikitaw rel=me><script defer src=https://static.cloudflareinsights.com/beacon.min.js data-cf-beacon='{"token": "c8303eac703c45b89db3207660f3a5a3"}'></script></head><body class="flex flex-col h-screen px-6 m-auto text-lg leading-7 max-w-7xl bg-neutral text-neutral-900 dark:bg-neutral-800 dark:text-neutral sm:px-14 md:px-24 lg:px-32"><div id=the-top class="absolute flex self-center"><a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 focus:translate-y-0 dark:bg-neutral-600" href=#main-content><span class="font-bold pe-2 text-primary-600 dark:text-primary-400">&darr;</span>Skip to main content</a></div><header class="py-6 font-semibold text-neutral-900 dark:text-neutral print:hidden sm:py-10"><nav class="flex items-start justify-between sm:items-center"><div class="z-40 flex flex-row items-center"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" rel=me href=/>nikita.computer</a></div><label id=menu-button for=menu-controller class="block sm:hidden"><input type=checkbox id=menu-controller class=hidden><div class="cursor-pointer hover:text-primary-600 dark:hover:text-primary-400"><span class="relative inline-block align-text-bottom px-1 icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentcolor" d="M0 96C0 78.33 14.33 64 32 64H416c17.7.0 32 14.33 32 32 0 17.7-14.3 32-32 32H32C14.33 128 0 113.7.0 96zM0 256c0-17.7 14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32H32c-17.67.0-32-14.3-32-32zM416 448H32c-17.67.0-32-14.3-32-32s14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32z"/></svg></span></div><div id=menu-wrapper class="invisible fixed inset-0 z-30 m-auto h-full w-full cursor-default overflow-auto bg-neutral-100/50 opacity-0 backdrop-blur-sm transition-opacity dark:bg-neutral-900/50"><ul class="mx-auto flex w-full max-w-7xl list-none flex-col overflow-visible px-6 py-6 ltr:text-right rtl:text-left sm:px-14 sm:py-10 sm:pt-10 md:px-24 lg:px-32"><li class=mb-1><span class="cursor-pointer hover:text-primary-600 dark:hover:text-primary-400"><span class="relative inline-block align-text-bottom px-1 icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentcolor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></span></li><li class="group mb-1"><a href=/posts/ title=Posts><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2">Posts</span></a></li><li class="group mb-1"><button id=search-button-m0 title="Search (/)">
<span class="group-dark:hover:text-primary-400 transition-colors group-hover:text-primary-600"><span class="relative inline-block align-text-bottom px-1 icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></span></button></li></ul></div></label><ul class="hidden list-none flex-row ltr:text-right rtl:text-left sm:flex"><li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0"><a href=/posts/ title=Posts><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2">Posts</span></a></li><li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0"><button id=search-button-m1 title="Search (/)">
<span class="group-dark:hover:text-primary-400 transition-colors group-hover:text-primary-600"><span class="relative inline-block align-text-bottom px-1 icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></span></button></li></ul></nav></header><div class="relative flex flex-col grow"><main id=main-content class=grow><article><header class=max-w-prose><ol class="text-sm text-neutral-500 dark:text-neutral-400 print:hidden"><li class="inline hidden"><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/></a><span class="px-1 text-primary-500">/</span></li><li class=inline><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/posts/>Posts</a><span class="px-1 text-primary-500">/</span></li><li class="inline hidden"><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/posts/makefile-tips/>Tips for using Makefiles in your projects</a><span class="px-1 text-primary-500">/</span></li></ol><h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">Tips for using Makefiles in your projects</h1><div class="mt-8 mb-12 text-base text-neutral-500 dark:text-neutral-400 print:hidden"><div class="flex flex-row flex-wrap items-center"><time datetime="2023-07-07 21:54:43 -0400 -0400">7 July 2023</time><span class="px-2 text-primary-500">&#183;</span><span>1252 words</span><span class="px-2 text-primary-500">&#183;</span><span title="Reading time">6 mins</span><span class="px-2 text-primary-500">&#183;</span>
<span class=mb-[2px]><a href=https://github.com/nikitawootten/nikitawootten.github.io/ class="text-lg hover:text-primary-500" rel="noopener noreferrer" target=_blank title="Edit content"><span class="relative inline-block align-text-bottom px-1 icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M490.3 40.4c21.9 21.87 21.9 57.33.0 79.2l-30 30.1-98-97.98 30.1-30.06C414.3-.2135 449.7-.2135 471.6 21.66L490.3 40.4zM172.4 241.7 339.7 74.34l98 97.96L270.3 339.6C264.2 345.8 256.7 350.4 248.4 353.2l-88.8 29.6C150.1 385.6 141.5 383.4 135 376.1 128.6 370.5 126.4 361 129.2 352.4l29.6-88.8C161.6 255.3 166.2 247.8 172.4 241.7v0zM192 63.1c17.7.0 32 15.23 32 32 0 18.6-14.3 32-32 32H96c-17.67.0-32 15.2-32 32V416c0 17.7 14.33 32 32 32H352c17.7.0 32-14.3 32-32V319.1c0-16.8 14.3-32 32-32s32 15.2 32 32V416c0 53-43 96-96 96H96c-53.02.0-96-43-96-96V159.1c0-53 42.98-96 96-96h96z"/></svg></span></a></span></div><div class="my-1 text-xs leading-relaxed text-neutral-500 dark:text-neutral-400"><a href=/tags/makefile/ class="rounded-md border border-neutral-200 px-1 py-[1px] hover:border-primary-300 hover:text-primary-700 dark:border-neutral-600 dark:hover:border-primary-600 dark:hover:text-primary-400">makefile</a>
<a href=/tags/nix/ class="rounded-md border border-neutral-200 px-1 py-[1px] hover:border-primary-300 hover:text-primary-700 dark:border-neutral-600 dark:hover:border-primary-600 dark:hover:text-primary-400">nix</a>
<a href=/tags/tips/ class="rounded-md border border-neutral-200 px-1 py-[1px] hover:border-primary-300 hover:text-primary-700 dark:border-neutral-600 dark:hover:border-primary-600 dark:hover:text-primary-400">tips</a></div></div></header><section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row"><div class="order-first px-0 lg:order-last lg:max-w-xs lg:ps-8"><div class="toc pe-5 print:hidden lg:sticky lg:top-10"><details open class="-ms-5 mt-0 overflow-hidden rounded-lg ps-5"><summary class="-ms-5 block cursor-pointer bg-neutral-100 py-1 ps-5 text-lg font-semibold text-neutral-800 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">Table of Contents</summary><div class="-ms-5 border-s border-dotted border-neutral-300 py-2 ps-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#tip-automatically-document-your-makefiles>Tip: Automatically document your Makefiles</a></li><li><a href=#tip-parallelize-your-makefile>Tip: Parallelize your Makefile</a></li><li><a href=#tip-augment-common-makefile-operations-with-canned-recipes>Tip: Augment common Makefile operations with canned recipes</a><ul><li><a href=#example-run-commands-within-a-nix-shell>Example: Run commands within a Nix shell</a></li><li><a href=#example-a-simple-for-each-recipe>Example: A simple For-Each recipe</a></li><li><a href=#example-extending-the-for-each-recipe-for-multi-makefile-monorepos>Example: Extending the For-Each recipe for multi-Makefile monorepos</a></li></ul></li><li><a href=#tip-use-makefile-include-for-multi-makefile-projects>Tip: Use Makefile <code>include</code> for multi-Makefile projects</a></li><li><a href=#conclusion>Conclusion</a></li></ul></nav></div></details></div></div><div class="min-w-0 min-h-0 max-w-prose grow"><div class="lead !mb-9 text-xl">I have a secret: I adore Makefiles.</div><p>I&rsquo;ll admit, the syntax is a bit arcane, and if you don&rsquo;t know what you&rsquo;re doing you can create some really insidious bugs, but once things are set up you can really improve the developer experience on your projects likely without requiring developers to install any <a href=https://github.com/casey/just target=_blank rel="noreferrer noopener">additional tools</a>.
In this post I&rsquo;d like to share some tips I&rsquo;ve gathered for making your Makefiles more effective.</p><div class="flex px-4 py-3 rounded-md bg-primary-100 dark:bg-primary-900"><span class="pe-3 text-primary-400"><span class="relative inline-block align-text-bottom px-1 icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M256 0C114.6.0.0 114.6.0 256s114.6 256 256 256 256-114.6 256-256S397.4.0 256 0zm0 128c17.67.0 32 14.33 32 32 0 17.67-14.33 32-32 32s-32-14.3-32-32 14.3-32 32-32zm40 256h-80c-13.2.0-24-10.7-24-24s10.75-24 24-24h16v-64h-8c-13.25.0-24-10.75-24-24s10.8-24 24-24h32c13.25.0 24 10.75 24 24v88h16c13.25.0 24 10.75 24 24s-10.7 24-24 24z"/></svg></span></span><span class=dark:text-neutral-300>This post assumes that you have surface knowledge of Makefiles.
If you&rsquo;d like to learn more about Makefiles, check out the resources in the <a href=#conclusion>conclusion</a>.</span></div><h2 id=tip-automatically-document-your-makefiles class="relative group">Tip: Automatically document your Makefiles <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#tip-automatically-document-your-makefiles aria-label=Anchor>#</a></span></h2><p>Picture this, you clone a random project off the internet.
The project&rsquo;s documentation instructs you to run <code>make help</code>, and to your delight you are greeted with a nicely formatted list of targets and their purpose.
This happened to me when playing around with a project called <a href=https://github.com/tiiuae/sbomnix/tree/main target=_blank rel="noreferrer noopener"><code>sbomnix</code></a> and since discovering it I&rsquo;ve begun including a &ldquo;self-documenting&rdquo; <code>help</code> target to all of my projects:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Makefile data-lang=Makefile><span class=line><span class=cl><span class=nf>.PHONY</span><span class=o>:</span> <span class=n>help</span>
</span></span><span class=line><span class=cl><span class=nf>help</span><span class=o>:</span> <span class=c>## Show this help message
</span></span></span><span class=line><span class=cl><span class=c></span>	@grep --no-filename -E <span class=s1>&#39;^[a-zA-Z_-]+:.*?##.*$$&#39;</span> <span class=k>$(</span>MAKEFILE_LIST<span class=k>)</span> <span class=p>|</span> awk <span class=s1>&#39;BEGIN { \
</span></span></span><span class=line><span class=cl><span class=s1>	 FS = &#34;:.*?## &#34;; \
</span></span></span><span class=line><span class=cl><span class=s1>	 printf &#34;\033[1m%-30s\033[0m %s\n&#34;, &#34;TARGET&#34;, &#34;DESCRIPTION&#34; \
</span></span></span><span class=line><span class=cl><span class=s1>	} \
</span></span></span><span class=line><span class=cl><span class=s1>	{ printf &#34;\033[32m%-30s\033[0m %s\n&#34;, $$1, $$2 }&#39;</span>
</span></span></code></pre></div><p>Now, running <code>make help</code> with a Makefile with this target present produces a nice list of targets and their description.
Any target annotated with <code>## &lt;comment></code> will show up (including the help target).
For example, here is the output of <code>make help</code> on the <a href=https://github.com/nikitawootten/nikitawootten.github.io/blob/main/Makefile target=_blank rel="noreferrer noopener">Makefile used to build this very site</a>:</p><figure><img class="mx-auto my-0 rounded-md" alt loading=lazy srcset="/posts/makefile-tips/images/make-help_hu3f60c88f944c0d4258fb8f41699ed876_34213_330x0_resize_box_3.png 330w,/posts/makefile-tips/images/make-help_hu3f60c88f944c0d4258fb8f41699ed876_34213_660x0_resize_box_3.png 660w,/posts/makefile-tips/images/make-help_hu3f60c88f944c0d4258fb8f41699ed876_34213_1024x0_resize_box_3.png 1024w,/posts/makefile-tips/images/make-help_hu3f60c88f944c0d4258fb8f41699ed876_34213_1320x0_resize_box_3.png 2x" src=/posts/makefile-tips/images/make-help_hu3f60c88f944c0d4258fb8f41699ed876_34213_660x0_resize_box_3.png></figure><p>This snippet is modified from <a href=https://marmelab.com/blog/2016/02/29/auto-documented-makefile.html target=_blank rel="noreferrer noopener">this blog post</a>.
I modified it to support targets within <a href=https://www.gnu.org/software/make/manual/html_node/Include.html target=_blank rel="noreferrer noopener">Makefile includes</a> and to add the header.
<a href=https://docs.cloudposse.com/reference/best-practices/make-best-practices/#help-target target=_blank rel="noreferrer noopener">Other variations</a> of this idea exist, choose one that suits you best, or make your own!</p><p>You might also want to consider making <code>help</code> your default goal:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Makefile data-lang=Makefile><span class=line><span class=cl><span class=c># Run the help goal when the user runs `make`
</span></span></span><span class=line><span class=cl><span class=c></span><span class=nf>.DEFAULT_GOAL</span><span class=o>:</span> <span class=n>help</span>
</span></span></code></pre></div><h2 id=tip-parallelize-your-makefile class="relative group">Tip: Parallelize your Makefile <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#tip-parallelize-your-makefile aria-label=Anchor>#</a></span></h2><p>For larger projects with a lot of moving parts, you could potentially drastically speed up your build by running some targets in parallel.
Faster builds means better developer productivity, and also much better CI performance!
GitHub Actions gives you a <a href=https://docs.github.com/en/actions/using-github-hosted-runners/about-github-hosted-runners#supported-runners-and-hardware-resources target=_blank rel="noreferrer noopener">2-core CPU by default</a>, so there is performance you are potentially leaving on the table!</p><p>Thankfully, running Make operations in parallel is trivially easy, just add a <code>--jobs &lt;n></code> flag (where <code>n</code> is the limit to the number of jobs a Makefile can run at once, usually the number of cores your machine has).</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=c1># Run the specified target with up to &lt;n&gt; jobs in parallel</span>
</span></span><span class=line><span class=cl>make &lt;target&gt; --jobs &lt;n&gt;
</span></span></code></pre></div><p>For more details, check out the <a href=https://www.gnu.org/software/make/manual/html_node/Parallel.html target=_blank rel="noreferrer noopener">&ldquo;Parallel Execution&rdquo; section of the GNU Make Manual</a>.</p><h2 id=tip-augment-common-makefile-operations-with-canned-recipes class="relative group">Tip: Augment common Makefile operations with canned recipes <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#tip-augment-common-makefile-operations-with-canned-recipes aria-label=Anchor>#</a></span></h2><p>Canned recipes are useful when several targets have a lot of similarities.
Recipes can also improve the readability of a Makefile.</p><p>For more details, see the <a href=https://www.gnu.org/software/make/manual/html_node/Canned-Recipes.html target=_blank rel="noreferrer noopener">&ldquo;Canned Recipes&rdquo; section of the GNU Make Manual</a>.</p><h3 id=example-run-commands-within-a-nix-shell class="relative group">Example: Run commands within a Nix shell <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#example-run-commands-within-a-nix-shell aria-label=Anchor>#</a></span></h3><p>Canned recipes are particularly useful for reducing the amount of repeated code, which can improve readability and reduce the possibility of mistakes.</p><p>For example, I house my <a href=https://github.com/nikitawootten/infra target=_blank rel="noreferrer noopener">NixOS configurations in a repository</a> with a Makefile for common operations (updating, building, etc).
Some of these commands run in a special <a href=https://nixos.org/manual/nix/stable/command-ref/nix-shell.html target=_blank rel="noreferrer noopener">Nix Shell</a> environment, allowing me to guarantee that the person running the commands has the correct dependencies.</p><p>I initially wrote my Makefile like this:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Makefile data-lang=Makefile><span class=line><span class=cl><span class=nf>.PHONY</span><span class=o>:</span> <span class=n>help</span> <span class=n>test</span> <span class=n>update</span> <span class=n>switch</span>-<span class=n>home</span> <span class=n>build</span>-<span class=n>home</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nf>test</span><span class=o>:</span> <span class=c>## Test flake outputs with &#34;nix flake check&#34;
</span></span></span><span class=line><span class=cl><span class=c></span>	nix-shell shell.nix --command <span class=s1>&#39;nix flake check&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nf>update</span><span class=o>:</span> <span class=c>## Update &#34;flake.lock&#34;
</span></span></span><span class=line><span class=cl><span class=c></span>	nix-shell shell.nix --command <span class=s1>&#39;nix flake update&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nf>switch-home</span><span class=o>:</span> <span class=c>## Switch local home-manager config
</span></span></span><span class=line><span class=cl><span class=c></span>	nix-shell shell.nix --command <span class=s1>&#39;home-manager switch --flake .&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nf>build-home</span><span class=o>:</span> <span class=c>## Build local home-manager config
</span></span></span><span class=line><span class=cl><span class=c></span>	nix-shell shell.nix --command <span class=s1>&#39;home-manager build --flake .&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># ... more targets excluded for brevity
</span></span></span></code></pre></div><p>Using canned recipes I reduced it to this:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Makefile data-lang=Makefile><span class=line><span class=cl><span class=c># Run command in nix-shell for maximum reproducibility (idiot [me] proofing)
</span></span></span><span class=line><span class=cl><span class=c></span><span class=err>define</span> <span class=err>IN_NIXSHELL</span>
</span></span><span class=line><span class=cl>	<span class=err>nix-shell</span> <span class=err>shell.nix</span> <span class=err>--command</span> <span class=s1>&#39;$1&#39;</span>
</span></span><span class=line><span class=cl><span class=err>endef</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nf>.PHONY</span><span class=o>:</span> <span class=n>help</span> <span class=n>test</span> <span class=n>update</span> <span class=n>switch</span>-<span class=n>home</span> <span class=n>build</span>-<span class=n>home</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nf>test</span><span class=o>:</span> <span class=c>## Test flake outputs with &#34;nix flake check&#34;
</span></span></span><span class=line><span class=cl><span class=c></span>	<span class=k>$(</span>call IN_NIXSHELL,nix flake check<span class=k>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nf>update</span><span class=o>:</span> <span class=c>## Update &#34;flake.lock&#34;
</span></span></span><span class=line><span class=cl><span class=c></span>	<span class=k>$(</span>call IN_NIXSHELL,nix flake update<span class=k>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nf>switch-home</span><span class=o>:</span> <span class=c>## Switch local home-manager config
</span></span></span><span class=line><span class=cl><span class=c></span>	<span class=k>$(</span>call IN_NIXSHELL,home-manager switch --flake .<span class=k>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nf>build-home</span><span class=o>:</span> <span class=c>## Build local home-manager config
</span></span></span><span class=line><span class=cl><span class=c></span>	<span class=k>$(</span>call IN_NIXSHELL,home-manager build --flake .<span class=k>)</span>
</span></span></code></pre></div><h3 id=example-a-simple-for-each-recipe class="relative group">Example: A simple For-Each recipe <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#example-a-simple-for-each-recipe aria-label=Anchor>#</a></span></h3><p>The following canned recipe creates a simple &ldquo;for-each&rdquo; loop:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Makefile data-lang=Makefile><span class=line><span class=cl><span class=c># $(call FOREACH,&lt;item variable&gt;,&lt;items list&gt;,&lt;command&gt;)
</span></span></span><span class=line><span class=cl><span class=c></span><span class=err>define</span> <span class=err>FOREACH</span>
</span></span><span class=line><span class=cl>	<span class=err>for</span> <span class=err>$1</span> <span class=err>in</span> <span class=err>$2;</span> <span class=err>do</span> <span class=err>{\</span>
</span></span><span class=line><span class=cl>		<span class=err>$3</span> <span class=err>;\</span>
</span></span><span class=line><span class=cl>	<span class=err>}</span> <span class=err>done</span>
</span></span><span class=line><span class=cl><span class=err>endef</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>friends</span><span class=o>:=</span>bob alice
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nf>.PHONY</span><span class=o>:</span> <span class=n>greet</span>
</span></span><span class=line><span class=cl><span class=nf>greet</span><span class=o>:</span>
</span></span><span class=line><span class=cl>	<span class=c1># Note that shell variables must be escaped with a double-$</span>
</span></span><span class=line><span class=cl>	<span class=k>$(</span>call FOREACH,friend,<span class=k>$(</span>friends<span class=k>)</span>,echo <span class=s2>&#34;hello </span><span class=nv>$$</span><span class=s2>friend&#34;</span><span class=k>)</span>
</span></span></code></pre></div><div class="flex px-4 py-3 rounded-md bg-primary-100 dark:bg-primary-900"><span class="pe-3 text-primary-400"><span class="relative inline-block align-text-bottom px-1 icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M506.3 417 293 53c-16.33-28-57.54-28-73.98.0l-213.2 364C-10.59 444.9 9.849 480 42.74 480h426.6c32.76.0 53.26-35 36.96-63zM232 168c0-13.25 10.75-24 24-24s24 10.8 24 24v128c0 13.25-10.75 24-23.1 24S232 309.3 232 296V168zm24 248c-17.36.0-31.44-14.08-31.44-31.44s14.07-31.44 31.44-31.44 31.44 14.08 31.44 31.44C287.4 401.9 273.4 416 256 416z"/></svg></span></span><span class=dark:text-neutral-300>This method does not play nicely with <a href=#tip-parallelize-your-makefile>parallelization</a>, since the loop runs serially.
In a lot of cases a better approach is to use <a href=https://www.gnu.org/software/make/manual/html_node/Pattern-Intro.html target=_blank rel="noreferrer noopener">patterns</a> and <a href=https://earthly.dev/blog/using-makefile-wildcards/ target=_blank rel="noreferrer noopener">wildcard rules</a></span></div><p>Running this makefile produces the output:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>$ make
</span></span><span class=line><span class=cl><span class=k>for</span> friend in bob alice<span class=p>;</span> <span class=k>do</span> <span class=o>{</span> <span class=nb>echo</span> <span class=s2>&#34;hello </span><span class=nv>$friend</span><span class=s2>&#34;</span> <span class=p>;</span> <span class=o>}</span> <span class=k>done</span>
</span></span><span class=line><span class=cl>hello bob
</span></span><span class=line><span class=cl>hello alice
</span></span></code></pre></div><h3 id=example-extending-the-for-each-recipe-for-multi-makefile-monorepos class="relative group">Example: Extending the For-Each recipe for multi-Makefile monorepos <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#example-extending-the-for-each-recipe-for-multi-makefile-monorepos aria-label=Anchor>#</a></span></h3><p>Sometimes you&rsquo;ll have repositories with a lot of moving parts, including several project each complete with their own Makefiles.
Wouldn&rsquo;t it be great to have a single top-level Makefile that can run the <code>test</code> target for each project?
Fortunately extending <a href=#example-a-simple-for-each-recipe>the For-Each recipe</a> to do so is trivial:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Makefile data-lang=Makefile><span class=line><span class=cl><span class=c># $(call FOREACH_MAKE,&lt;target&gt;,&lt;directories list&gt;)
</span></span></span><span class=line><span class=cl><span class=c># Run a Makefile target for each directory, requiring each directory to
</span></span></span><span class=line><span class=cl><span class=c># 	have a given target
</span></span></span><span class=line><span class=cl><span class=c></span><span class=err>define</span> <span class=err>FOREACH_MAKE</span>
</span></span><span class=line><span class=cl>	<span class=err>@echo</span> <span class=err>Running</span> <span class=err>makefile</span> <span class=err>target</span> <span class=err>\&#39;$1\&#39;</span> <span class=err>on</span> <span class=err>all</span> <span class=err>subdirectory</span> <span class=err>makefiles</span>
</span></span><span class=line><span class=cl>	<span class=err>@</span><span class=k>$(</span><span class=nv>call</span> <span class=nv>FOREACH</span>,<span class=nv>dir</span>,<span class=k>$</span>2,<span class=k>$(</span><span class=nv>MAKE</span><span class=k>)</span> -<span class=nv>C</span> <span class=k>$$</span><span class=nv>dir</span> <span class=k>$</span>1<span class=k>)</span>
</span></span><span class=line><span class=cl><span class=err>endef</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># For all Makefiles matched by the wildcard, extract the directory
</span></span></span><span class=line><span class=cl><span class=c></span><span class=nv>dirs</span><span class=o>:=</span><span class=k>$(</span>dir <span class=k>$(</span>wildcard ./*/Makefile<span class=k>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nf>.PHONY</span><span class=o>:</span> <span class=n>test</span>
</span></span><span class=line><span class=cl><span class=nf>test</span><span class=o>:</span> <span class=c>## Run all tests
</span></span></span><span class=line><span class=cl><span class=c></span>	<span class=k>$(</span>call FOREACH_MAKE,<span class=nv>$@</span>,<span class=k>$(</span><span class=nb>dirs</span><span class=k>))</span>
</span></span></code></pre></div><p>Running <code>make test</code> now runs each sub-directory&rsquo;s <code>test</code> target.</p><p>In some cases you might want to run a target on each Makefile, ignoring Makefiles that do not define one.
For example, say some sub-projects have a <code>clean</code> target, and others don&rsquo;t.
The following canned recipe allows you to run <code>make clean</code> only on directories that have a <code>clean</code> target:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Makefile data-lang=Makefile><span class=line><span class=cl><span class=c># $(call FOREACH_MAKE_OPTIONAL,&lt;target&gt;,&lt;directories list&gt;)
</span></span></span><span class=line><span class=cl><span class=c># Run a Makefile target for each directory, skipping directories whose Makefile does not contain a rule
</span></span></span><span class=line><span class=cl><span class=c></span><span class=err>define</span> <span class=err>FOREACH_MAKE_OPTIONAL</span>
</span></span><span class=line><span class=cl>	<span class=err>@echo</span> <span class=err>Running</span> <span class=err>makefile</span> <span class=err>target</span> <span class=err>\</span><span class=s1>&#39;$1\&#39; on all subdirectory makefiles that contain the rule
</span></span></span><span class=line><span class=cl><span class=s1>	@$(call FOREACH,dir,$2,$(MAKE) -C $$dir -n $1 &amp;&gt; /dev/null &amp;&amp; $(MAKE) -C $$dir $1 || echo &#34;Makefile target &#39;</span><span class=err>$1&#39;</span> <span class=err>does</span> <span class=err>not</span> <span class=err>exist</span> <span class=err>in</span> <span class=s2>&#34;$$dir&#34;</span><span class=err>.</span> <span class=err>Continuing...&#34;)</span>
</span></span><span class=line><span class=cl><span class=err>endef</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>dirs</span><span class=o>:=</span><span class=k>$(</span>dir <span class=k>$(</span>wildcard ./*/Makefile<span class=k>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nf>.PHONY</span><span class=o>:</span> <span class=n>clean</span>
</span></span><span class=line><span class=cl><span class=nf>clean</span><span class=o>:</span> <span class=c>## Remove any generated test or build artifacts
</span></span></span><span class=line><span class=cl><span class=c></span>	<span class=k>$(</span>call FOREACH_MAKE_OPTIONAL,<span class=nv>$@</span>,<span class=k>$(</span><span class=nb>dirs</span><span class=k>))</span>
</span></span></code></pre></div><h2 id=tip-use-makefile-include-for-multi-makefile-projects class="relative group">Tip: Use Makefile <code>include</code> for multi-Makefile projects <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#tip-use-makefile-include-for-multi-makefile-projects aria-label=Anchor>#</a></span></h2><p>Using some of the tips you&rsquo;ve gathered in this post, you may have accrued quite a bit of boilerplate now replicated in multiple Makefiles within the same repository.
Maybe now you&rsquo;ve added <a href=#tip-automatically-document-your-makefiles>a &ldquo;help&rdquo; target to each Makefile</a> and <a href=#tip-augment-common-makefile-operations-with-canned-recipes>one or two shared canned recipes</a>.
This is not very <a href=https://en.wikipedia.org/wiki/Don%27t_repeat_yourself target=_blank rel="noreferrer noopener">DRY</a>, we can do better!</p><p>Fortunately, <a href=https://www.gnu.org/software/make/manual/html_node/Include.html target=_blank rel="noreferrer noopener">Makefile includes</a> make it simple to consolidate shared roles, recipes, and variables.</p><div class="flex px-4 py-3 rounded-md bg-primary-100 dark:bg-primary-900"><span class="pe-3 text-primary-400"><span class="relative inline-block align-text-bottom px-1 icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M256 0C114.6.0.0 114.6.0 256s114.6 256 256 256 256-114.6 256-256S397.4.0 256 0zm0 128c17.67.0 32 14.33 32 32 0 17.67-14.33 32-32 32s-32-14.3-32-32 14.3-32 32-32zm40 256h-80c-13.2.0-24-10.7-24-24s10.75-24 24-24h16v-64h-8c-13.25.0-24-10.75-24-24s10.8-24 24-24h32c13.25.0 24 10.75 24 24v88h16c13.25.0 24 10.75 24 24s-10.7 24-24 24z"/></svg></span></span><span class=dark:text-neutral-300>Makefile inclusions are not &ldquo;namespaced&rdquo;, so beware of clashing target and variable names.</span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-Makefile data-lang=Makefile><span class=line><span class=cl><span class=c># Include the contents of the Makefile ../shared/common.mk
</span></span></span><span class=line><span class=cl><span class=c></span><span class=err>include</span> <span class=err>../shared/common.mk</span>
</span></span></code></pre></div><h2 id=conclusion class="relative group">Conclusion <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#conclusion aria-label=Anchor>#</a></span></h2><p>If you have any Makefile tips that you&rsquo;d like to share, feel free to leave a comment below or contact me.</p><p>If you&rsquo;d like to learn more about Makefiles, check out some of the links below:</p><ul><li><a href=https://endler.dev/2017/makefiles/ target=_blank rel="noreferrer noopener">This really gentle introduction to Makefiles</a> is great to send to team members looking to get started.</li><li><a href=https://www.gnu.org/software/make/manual/html_node/ target=_blank rel="noreferrer noopener">The GNU Make Manual</a> is an excellent reference. I find something interesting each time I read through it.</li><li><a href=https://marmelab.com/blog/2016/02/29/auto-documented-makefile.html target=_blank rel="noreferrer noopener">Self-Documented Makefile</a> is the excellent blog whose <a href=#tip-automatically-document-your-makefiles>&ldquo;help&rdquo; target I modified above</a>.</li></ul></div></section><footer class="pt-8 max-w-prose print:hidden"><div class=flex><img class="!mb-0 !mt-0 me-4 h-24 w-24 rounded-full" width=96 height=96 alt="Nikita Wootten" src=/img/lucya_huff674df71d5f4b525de779cc99124df9_346497_192x192_fill_box_center_3.png loading=lazy><div class=place-self-center><div class="text-[0.6rem] uppercase leading-3 text-neutral-500 dark:text-neutral-400">Author</div><div class="font-semibold leading-6 text-neutral-800 dark:text-neutral-300">Nikita Wootten</div><div class="text-2xl sm:text-lg"><div class="flex flex-wrap text-neutral-400 dark:text-neutral-500"><a class="px-1 transition-transform hover:scale-125 hover:text-primary-700 dark:hover:text-primary-400" style=will-change:transform href=mailto:stdin@nikita.computer target=_blank aria-label=Email rel="me noopener noreferrer"><span class="relative inline-block align-text-bottom px-1 icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M207.8 20.73c-93.45 18.32-168.7 93.66-187 187.1-27.64 140.9 68.65 266.2 199.1 285.1 19.01 2.888 36.17-12.26 36.17-31.49l1e-4-.6631c0-15.74-11.44-28.88-26.84-31.24-84.35-12.98-149.2-86.13-149.2-174.2.0-102.9 88.61-185.5 193.4-175.4 91.54 8.869 158.6 91.25 158.6 183.2v16.16c0 22.09-17.94 40.05-40 40.05s-40.01-17.96-40.01-40.05v-120.1c0-8.847-7.161-16.02-16.01-16.02l-31.98.0036c-7.299.0-13.2 4.992-15.12 11.68-24.85-12.15-54.24-16.38-86.06-5.106-38.75 13.73-68.12 48.91-73.72 89.64-9.483 69.01 43.81 128 110.9 128 26.44.0 50.43-9.544 69.59-24.88 24 31.3 65.23 48.69 109.4 37.49C465.2 369.3 496 324.1 495.1 277.2V256.3c0-149.2-133.9-265.632-287.3-235.57zM239.1 304.3c-26.47.0-48-21.56-48-48.05s21.53-48.05 48-48.05 48 21.56 48 48.05-20.6 48.05-48 48.05z"/></svg></span></a><a class="px-1 transition-transform hover:scale-125 hover:text-primary-700 dark:hover:text-primary-400" style=will-change:transform href=https://github.com/nikitawootten target=_blank aria-label=Github rel="me noopener noreferrer"><span class="relative inline-block align-text-bottom px-1 icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentcolor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span></a><a class="px-1 transition-transform hover:scale-125 hover:text-primary-700 dark:hover:text-primary-400" style=will-change:transform href=https://www.linkedin.com/in/nikita-wootten/ target=_blank aria-label=Linkedin rel="me noopener noreferrer"><span class="relative inline-block align-text-bottom px-1 icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentcolor" d="M416 32H31.9C14.3 32 0 46.5.0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6.0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3.0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2.0 38.5 17.3 38.5 38.5.0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6.0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2.0 79.7 44.3 79.7 101.9V416z"/></svg></span></a><a class="px-1 transition-transform hover:scale-125 hover:text-primary-700 dark:hover:text-primary-400" style=will-change:transform href=https://mstdn.social/@nikitaw target=_blank aria-label=Mastodon rel="me noopener noreferrer"><span class="relative inline-block align-text-bottom px-1 icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentcolor" d="M433 179.11c0-97.2-63.71-125.7-63.71-125.7-62.52-28.7-228.56-28.4-290.48.0.0.0-63.72 28.5-63.72 125.7.0 115.7-6.6 259.4 105.63 289.1 40.51 10.7 75.32 13 103.33 11.4 50.81-2.8 79.32-18.1 79.32-18.1l-1.7-36.9s-36.31 11.4-77.12 10.1c-40.41-1.4-83-4.4-89.63-54a102.54 102.54.0 01-.9-13.9c85.63 20.9 158.65 9.1 178.75 6.7 56.12-6.7 105-41.3 111.23-72.9 9.8-49.8 9-121.5 9-121.5zm-75.12 125.2h-46.63v-114.2c0-49.7-64-51.6-64 6.9v62.5h-46.33V197c0-58.5-64-56.6-64-6.9v114.2H90.19c0-122.1-5.2-147.9 18.41-175 25.9-28.9 79.82-30.8 103.83 6.1l11.6 19.5 11.6-19.5c24.11-37.1 78.12-34.8 103.83-6.1 23.71 27.3 18.4 53 18.4 175z"/></svg></span></a></div></div></div></div><section class="flex flex-row flex-wrap justify-center pt-4 text-xl"><a class="m-1 inline-block min-w-[2.4rem] rounded bg-neutral-300 p-1 text-center text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://tootpick.org/#text=https://nikita.computer/posts/makefile-tips/%20Tips%20for%20using%20Makefiles%20in%20your%20projects" title="Toot on Mastodon" aria-label="Toot on Mastodon" target=_blank rel="noopener noreferrer"><span class="relative inline-block align-text-bottom px-1 icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentcolor" d="M433 179.11c0-97.2-63.71-125.7-63.71-125.7-62.52-28.7-228.56-28.4-290.48.0.0.0-63.72 28.5-63.72 125.7.0 115.7-6.6 259.4 105.63 289.1 40.51 10.7 75.32 13 103.33 11.4 50.81-2.8 79.32-18.1 79.32-18.1l-1.7-36.9s-36.31 11.4-77.12 10.1c-40.41-1.4-83-4.4-89.63-54a102.54 102.54.0 01-.9-13.9c85.63 20.9 158.65 9.1 178.75 6.7 56.12-6.7 105-41.3 111.23-72.9 9.8-49.8 9-121.5 9-121.5zm-75.12 125.2h-46.63v-114.2c0-49.7-64-51.6-64 6.9v62.5h-46.33V197c0-58.5-64-56.6-64-6.9v114.2H90.19c0-122.1-5.2-147.9 18.41-175 25.9-28.9 79.82-30.8 103.83 6.1l11.6 19.5 11.6-19.5c24.11-37.1 78.12-34.8 103.83-6.1 23.71 27.3 18.4 53 18.4 175z"/></svg></span></a><a class="m-1 inline-block min-w-[2.4rem] rounded bg-neutral-300 p-1 text-center text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://reddit.com/submit/?url=https://nikita.computer/posts/makefile-tips/&amp;resubmit=true&amp;title=Tips%20for%20using%20Makefiles%20in%20your%20projects" title="Submit to Reddit" aria-label="Submit to Reddit" target=_blank rel="noopener noreferrer"><span class="relative inline-block align-text-bottom px-1 icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M201.5 305.5c-13.8.0-24.9-11.1-24.9-24.6.0-13.8 11.1-24.9 24.9-24.9 13.6.0 24.6 11.1 24.6 24.9.0 13.6-11.1 24.6-24.6 24.6zM504 256c0 137-111 248-248 248S8 393 8 256 119 8 256 8s248 111 248 248zm-132.3-41.2c-9.4.0-17.7 3.9-23.8 10-22.4-15.5-52.6-25.5-86.1-26.6l17.4-78.3 55.4 12.5c0 13.6 11.1 24.6 24.6 24.6 13.8.0 24.9-11.3 24.9-24.9s-11.1-24.9-24.9-24.9c-9.7.0-18 5.8-22.1 13.8l-61.2-13.6c-3-.8-6.1 1.4-6.9 4.4l-19.1 86.4c-33.2 1.4-63.1 11.3-85.5 26.8-6.1-6.4-14.7-10.2-24.1-10.2-34.9.0-46.3 46.9-14.4 62.8-1.1 5-1.7 10.2-1.7 15.5.0 52.6 59.2 95.2 132 95.2 73.1.0 132.3-42.6 132.3-95.2.0-5.3-.6-10.8-1.9-15.8 31.3-16 19.8-62.5-14.9-62.5zM302.8 331c-18.2 18.2-76.1 17.9-93.6.0-2.2-2.2-6.1-2.2-8.3.0-2.5 2.5-2.5 6.4.0 8.6 22.8 22.8 87.3 22.8 110.2.0 2.5-2.2 2.5-6.1.0-8.6-2.2-2.2-6.1-2.2-8.3.0zm7.7-75c-13.6.0-24.6 11.1-24.6 24.9.0 13.6 11.1 24.6 24.6 24.6 13.8.0 24.9-11.1 24.9-24.6.0-13.8-11-24.9-24.9-24.9z"/></svg></span></a><a class="m-1 inline-block min-w-[2.4rem] rounded bg-neutral-300 p-1 text-center text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://nikita.computer/posts/makefile-tips/&amp;title=Tips%20for%20using%20Makefiles%20in%20your%20projects" title="Share on LinkedIn" aria-label="Share on LinkedIn" target=_blank rel="noopener noreferrer"><span class="relative inline-block align-text-bottom px-1 icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentcolor" d="M416 32H31.9C14.3 32 0 46.5.0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6.0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3.0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2.0 38.5 17.3 38.5 38.5.0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6.0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2.0 79.7 44.3 79.7 101.9V416z"/></svg></span></a><a class="m-1 inline-block min-w-[2.4rem] rounded bg-neutral-300 p-1 text-center text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="mailto:?body=https://nikita.computer/posts/makefile-tips/&amp;subject=Tips%20for%20using%20Makefiles%20in%20your%20projects" title="Send via email" aria-label="Send via email" target=_blank rel="noopener noreferrer"><span class="relative inline-block align-text-bottom px-1 icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M207.8 20.73c-93.45 18.32-168.7 93.66-187 187.1-27.64 140.9 68.65 266.2 199.1 285.1 19.01 2.888 36.17-12.26 36.17-31.49l1e-4-.6631c0-15.74-11.44-28.88-26.84-31.24-84.35-12.98-149.2-86.13-149.2-174.2.0-102.9 88.61-185.5 193.4-175.4 91.54 8.869 158.6 91.25 158.6 183.2v16.16c0 22.09-17.94 40.05-40 40.05s-40.01-17.96-40.01-40.05v-120.1c0-8.847-7.161-16.02-16.01-16.02l-31.98.0036c-7.299.0-13.2 4.992-15.12 11.68-24.85-12.15-54.24-16.38-86.06-5.106-38.75 13.73-68.12 48.91-73.72 89.64-9.483 69.01 43.81 128 110.9 128 26.44.0 50.43-9.544 69.59-24.88 24 31.3 65.23 48.69 109.4 37.49C465.2 369.3 496 324.1 495.1 277.2V256.3c0-149.2-133.9-265.632-287.3-235.57zM239.1 304.3c-26.47.0-48-21.56-48-48.05s21.53-48.05 48-48.05 48 21.56 48 48.05-20.6 48.05-48 48.05z"/></svg></span></a></section><div class=pt-8><hr class="border-dotted border-neutral-300 dark:border-neutral-600"><div class="flex justify-between pt-3"><span><a class="group flex" href=/posts/packaging-node-applications-in-nix/><span class="me-2 text-neutral-700 transition-transform group-hover:-translate-x-[2px] group-hover:text-primary-600 dark:text-neutral dark:group-hover:text-primary-400"><span class="ltr:inline rtl:hidden">&larr;</span><span class="ltr:hidden rtl:inline">&rarr;</span></span>
<span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">Packaging Node Applications in Nix using Yarn2Nix</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime="2023-04-08 09:15:40 -0500 -0500">8 April 2023</time></span></span></a></span>
<span></span></div></div><div class=pt-3><hr class="border-dotted border-neutral-300 dark:border-neutral-600"><div class=pt-3><script src=https://giscus.app/client.js data-repo=nikitawootten/nikitawootten.github.io data-repo-id=R_kgDOHRFEvA data-category=Article data-category-id=DIC_kwDOHRFEvM4CTkK0 data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-theme=preferred_color_scheme data-lang=en data-loading=lazy crossorigin=anonymous async></script></div></div></footer></article></main><footer class="py-10 print:hidden"><div class="flex items-center justify-between"><div><p class="text-sm text-neutral-500 dark:text-neutral-400">The content for this site is <a href=https://creativecommons.org/licenses/by/2.0/ target=_blank rel="noreferrer noopener">CC-BY 2.0</a>, the <a href=https://github.com/nikitawootten/nikitawootten.github.io target=_blank rel="noreferrer noopener">code</a> is <a href=https://github.com/nikitawootten/nikitawootten.github.io/blob/main/LICENSE target=_blank rel="noreferrer noopener">MIT</a></p><p class="text-xs text-neutral-500 dark:text-neutral-400">Powered by <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://gohugo.io/ target=_blank rel="noopener noreferrer">Hugo</a> & <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://git.io/hugo-congo target=_blank rel="noopener noreferrer">Congo</a></p></div></div><div class=mt-6><section class=webring><h3>Articles from blogs I follow around the net:</h3><section class="flex flex-wrap"><div class="article flex flex-col m-1 p-1 bg-neutral-300 dark:bg-neutral-600"><h4 class=m-0><a href=https://computer.rip/2024-03-17-wilhelm-haller-and-photocopier-accounting.html target=_blank rel=noopener>2024-03-17 wilhelm haller and photocopier accounting</a></h4><p class=summary>In the 1450s, German inventor Johannes Gutenburg designed the movable-type
printing press, the first practical method of mass-duplicating text. After
various other projects, he applied his press to the production of the Bible,
yielding over one hundred copi…</p><small>via <a href=https://computer.rip>computers are bad</a></small>
<small>March 17, 2024</small></div><div class="article flex flex-col m-1 p-1 bg-neutral-300 dark:bg-neutral-600"><h4 class=m-0><a href=https://xeiaso.net/talks/2024/nix-docker-build/ target=_blank rel=noopener>Nix is a better Docker image builder than Docker's image builder</a></h4><p class=summary>Douglas Adams QuotesLive: douglas-adams-quotes.fly.dev
Source code: github:Xe/douglas-adams-quotesgomod2nix$50 of Fly.io CreditsCoupon code go-fly-nix. Only valid for new accounts that have not used a DevRel coupon code before.Slides and Vi…</p><small>via <a href=https://xeiaso.net/>Xe Iaso's blog</a></small>
<small>March 15, 2024</small></div><div class="article flex flex-col m-1 p-1 bg-neutral-300 dark:bg-neutral-600"><h4 class=m-0><a href=https://pluralistic.net/2024/03/15/wellness-taylorism/ target=_blank rel=noopener>Pluralistic: Wellness surveillance makes workers unwell (15 Mar 2024)</a></h4><p class=summary>Today's links Wellness surveillance makes workers unwell: As ever, the important thing isn't what the gadget does, it's who it does it for and who it does it to. Hey look at this: Delights to delectate. This day in history: 2004, 2009, 2014, 2…</p><small>via <a href=https://pluralistic.net>Pluralistic: Daily links from Cory Doctorow</a></small>
<small>March 15, 2024</small></div></section><p class="text-sm text-neutral-500 dark:text-neutral-400 text-right">Generated by
<a href=https://git.sr.ht/~sircmpwn/openring>openring</a></p></section><style>.webring .article{flex:1;min-width:10rem}.webring .summary{flex:1;font-size:.8rem}</style></div></footer><div id=search-wrapper class="invisible fixed inset-0 z-50 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh]" data-url=https://nikita.computer/><div id=search-modal class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg top-20 border-neutral-200 bg-neutral dark:border-neutral-700 dark:bg-neutral-800"><header class="relative z-10 flex items-center justify-between flex-none px-2"><form class="flex items-center flex-auto min-w-0"><div class="flex items-center justify-center w-8 h-8 text-neutral-400"><span class="relative inline-block align-text-bottom px-1 icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></div><input type=search id=search-query class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent" placeholder=Search tabindex=0></form><button id=close-search-button class="flex items-center justify-center w-8 h-8 text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400" title="Close (Esc)">
<span class="relative inline-block align-text-bottom px-1 icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentcolor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></button></header><section class="flex-auto px-2 overflow-auto"><ul id=search-results></ul></section></div></div></div></body></html>